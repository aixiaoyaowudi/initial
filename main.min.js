if (document.getElementById("body").hasAttribute("in-pjax")) {
	jQuery.fn.Shake = function(n, d) {
		this.each(function() {
			var a = $(this);
			a.css({
				position: 'relative'
			});
			for (var x = 1; x <= n; x++) {
				a.animate({
					left: (-d)
				}, 50).animate({
					left: d
				}, 50).animate({
					left: 0
				}, 50)
			}
		});
		return this
	};
	$(document).pjax('a:not(a[target="_blank"], a[no-pjax])', {
		container: '#main',
		fragment: '#main',
		timeout: 10000
	}).on('submit', 'form[id=search], form[id=comment-form]', function(a) {
		$.pjax.submit(a, {
			container: '#main',
			fragment: '#main',
			timeout: 10000
		})
	}).on('pjax:send', function() {
		$("#header").prepend("<div id='bar'></div>")
	}).on('pjax:complete', function() {
		setTimeout(function() {
			$("#bar").remove()
		}, 300);
		$('#header').removeClass("on");
		$('#s').val("");
		$("#secondary").removeAttr("style");
		if (typeof hljs !== 'undefined') {
			document.querySelectorAll('pre code').forEach((block) => {
				hljs.highlightBlock(block)
			})
		}
	}).on('pjax:end', function() {
		if ($('.ajaxload').length) {
			al()
		}
		cl();
		ac();
		ap();
		if (typeof _hmt !== 'undefined') {
			_hmt.push(['_trackPageview', location.pathname + location.search])
		}
		if (typeof ga !== 'undefined') {
			ga('send', 'pageview', location.pathname + location.search)
		}
	});

	function ac() {
		$body = $('html,body');
		var g = '.comment-list',
			h = '.comment-num',
			i = '.comment-reply a',
			wi = '.whisper-reply',
			j = '#textarea',
			k = '',
			l = '';
		c();
		$('#comment-form').submit(function() {
			$.ajax({
				url: $(this).attr('action'),
				type: 'post',
				data: $(this).serializeArray(),
				error: function() {
					alert("提交失败，请检查网络并重试或者联系管理员。");
					return false
				},
				success: function(d) {
					if (!$(g, d).length) {
						alert("您输入的内容不符合规则或者回复太频繁，请修改内容或者稍等片刻。");
						return false
					} else {
						k = $(g, d).html().match(/id=\"?comment-\d+/g).join().match(/\d+/g).sort(function(a, b) {
							return a - b
						}).pop();
						if ($('.page-navigator .prev').length && l == "") {
							k = ''
						}
						if (l) {
							d = $('#li-comment-' + k, d).hide();
							if ($('#' + l).find(".comment-children").length <= 0) {
								$('#' + l).append("<div class='comment-children'><ol class='comment-list'><\/ol><\/div>")
							}
							if (k) $('#' + l + " .comment-children .comment-list").prepend(d);
							l = ''
						} else {
							d = $('#li-comment-' + k, d).hide();
							if (!$(g).length) $('#comments').prepend("<h3>已有 <span class='comment-num'>0<\/span> 条评论<\/h3><ol class='comment-list'><\/ol>");
							$(g).prepend(d)
						}
						$('#li-comment-' + k).fadeIn();
						var f;
						$(h).length ? (f = parseInt($(h).text().match(/\d+/)), $(h).html($(h).html().replace(f, f + 1))) : 0;
						TypechoComment.cancelReply();
						$(j).val('');
						$(i + ',' + wi + ', #cancel-comment-reply-link').off('click');
						c();
						if (k) {
							$body.animate({
								scrollTop: $('#li-comment-' + k).offset().top - 50
							}, 300)
						} else {
							$body.animate({
								scrollTop: $('#comments').offset().top - 50
							}, 300)
						}
					}
				}
			});
			return false
		});

		function c() {
			$(i + ',' + wi).click(function() {
				l = $(this).parent().parent().parent().attr("id")
			});
			$('#cancel-comment-reply-link').click(function() {
				l = ''
			})
		}
	}
	ac();
	if (document.getElementById("token")) {
		var protoken = document.getElementById("token").value.replace('Token', "")
	}

	function ap() {
		$('.protected .post-title a, .protected .more a').click(function() {
			var a = $(this).parent().parent();
			a.find('.word').text("请输入密码访问").css('color', 'red').Shake(2, 10);
			a.find(':password').focus();
			return false
		});
		$('.protected form').submit(function() {
			ap_btn = $(this);
			ap_n = ap_btn.find('.word');
			$(ap_n).removeAttr("style").addClass('loading').text("请稍等");
			$('.ajaxload').length ? aps() : apt();
			return false
		})
	}
	ap();

	function apt() {
		var b = $('.protected .post-title a').attr("href");
		if ($('h1.post-title').length) {
			protoken = $('.protected form').attr("action").replace(b, "");
			aps()
		} else {
			$.ajax({
				url: window.location.href,
				success: function(d) {
					protoken = $('.protected form[action^="' + b + '"]', d).attr("action").replace(b, "");
					aps()
				}
			})
		}
	}

	function aps() {
		var c = ap_btn.parent().parent().find('.post-title a').attr("href");
		$.ajax({
			url: c + protoken,
			type: 'post',
			data: ap_btn.serializeArray(),
			error: function() {
				rt();
				ap_n.text("提交失败，请检查网络并重试或者联系管理员。").css('color', 'red').Shake(2, 10);
				return false
			},
			success: function(d) {
				if (!$('h1.post-title', d).length) {
					rt();
					ap_n.text("对不起,您输入的密码错误。").css('color', 'red').Shake(2, 10);
					$(":password").val("");
					return false
				} else {
					rt();
					ap_n.text("密码正确，如果没有跳转新页面，请手动刷新本页。").css('color', 'blue');
					$('h1.post-title').length ? $.pjax.reload({
						container: '#main',
						fragment: '#main',
						timeout: 10000
					}) : $.pjax({
						url: c,
						container: '#main',
						fragment: '#main',
						timeout: 10000
					})
				}
			}
		});

		function rt() {
			$(ap_n).removeClass("loading")
		}
	}
}
var isbool = true;

function al() {
	$('.ajaxload li[class!="next"]').remove();
	$('.ajaxload .next a').click(function() {
		if (isbool) {
			isbool = false;
			aln()
		}
		return false
	})
}

function aln() {
	var a = '.ajaxload .next a',
		b = $(a).attr("href");
	$(a).addClass('loading').text("正在加载");
	if (b) {
		$.ajax({
			url: b,
			error: function() {
				alert('请求失败，请检查网络并重试或者联系管理员');
				$(a).removeAttr("class").text("查看更多");
				isbool = true;
				return false
			},
			success: function(d) {
				var c = $(d).find("#main .post"),
					e = $(d).find(a).attr("href");
				if (c) {
					$('.ajaxload').before(c)
				}
				$(a).removeAttr("class");
				if (e) {
					$(a).text("查看更多").attr("href", e)
				} else {
					$(a).remove();
					$('.ajaxload .next').text('没有更多文章了')
				} if ($('.protected', d).length) {
					$('.protected *').off();
					ap()
				}
				isbool = true;
				load();
				return false
			}
		})
	}
}
if (document.getElementsByClassName("ajaxload").length) {
	al();
	if ($('.ajaxload.auto').length) {
		$(window).scroll(function() {
			if (isbool && $('.ajaxload .next a').attr("href") && ($(this).scrollTop() + $(window).height() + 5) >= $(document).height()) {
				isbool = false;
				aln()
			}
		})
	}
}
window.onscroll = function() {
	var a = document.body.scrollTop || document.documentElement.scrollTop;
	var x = document.getElementById("top");
	var y = document.getElementById("secondary");
	var z = document.getElementsByTagName('body')[0].classList.contains('head-fixed');
	if (x) {
		var b = document.getElementById("top");
		if (a >= 200) {
			b.removeAttribute("class")
		} else {
			b.setAttribute("class", "hidden")
		}
		b.onclick = function totop() {
			var a = document.body.scrollTop || document.documentElement.scrollTop;
			if (a > 1) {
				requestAnimationFrame(totop);
				scrollTo(0, a - (a / 5))
			} else {
				cancelAnimationFrame(totop);
				scrollTo(0, 0)
			}
		}
	}
	if (z) {
		var c = document.getElementById("header");
		if (a > 0 && a < 30) {
			c.style.padding = (15 - a / 2) + "px 0"
		} else if (a >= 30) {
			c.style.padding = 0
		} else {
			c.removeAttribute("style")
		}
	}
	if (y && y.hasAttribute("sidebar-fixed")) {
		var d = document.getElementById("main");
		var e = document.documentElement.clientHeight;
		var f = z ? 0 : 41;
		if (d.offsetHeight > y.offsetHeight) {
			if (y.offsetHeight > e - 71 && a > y.offsetHeight + 101 - e) {
				if (a < d.offsetHeight + 101 - e) {
					y.style.marginTop = (a - y.offsetHeight - 101 + e) + "px"
				} else {
					y.style.marginTop = (d.offsetHeight - y.offsetHeight) + "px"
				}
			} else if (y.offsetHeight <= e - 71 && a > 30 + f) {
				if (a < d.offsetHeight - y.offsetHeight + f) {
					y.style.marginTop = (a - 30 - f) + "px"
				} else {
					y.style.marginTop = (d.offsetHeight - y.offsetHeight - 30) + "px"
				}
			} else {
				y.removeAttribute("style")
			}
		}
	}
};
if (document.getElementById("music")) {
	(function() {
		var a = document.getElementById("audio");
		var b = document.getElementById("music");
		var c = a.getAttribute("data-src").split(",");
		var d = a.getAttribute("data-vol");
		if (d && d >= 0 && d <= 1) {
			a.volume = d
		}
		a.src = c.shift();
		a.addEventListener('play', g);
		a.addEventListener('pause', h);
		a.addEventListener('ended', f);
		a.addEventListener('error', f);
		a.addEventListener('canplay', j);

		function f() {
			if (!c.length) {
				a.removeEventListener('play', g);
				a.removeEventListener('pause', h);
				a.removeEventListener('ended', f);
				a.removeEventListener('error', f);
				a.removeEventListener('canplay', j);
				b.style.display = "none";
				alert("本站的背景音乐好像有问题了，希望您可以通过留言等方式通知管理员，谢谢您的帮助。")
			} else {
				a.src = c.shift();
				a.play()
			}
		}

		function g() {
			b.setAttribute("class", "play");
			a.addEventListener('timeupdate', k)
		}

		function h() {
			b.removeAttribute("class");
			a.removeEventListener('timeupdate', k)
		}

		function j() {
			c.push(a.src)
		}

		function k() {
			b.getElementsByTagName("i")[0].style.width = (a.currentTime / a.duration * 100).toFixed(1) + "%"
		}
		b.onclick = function() {
			if (a.canPlayType('audio/mpeg') != "" || a.canPlayType('audio/ogg;codes="vorbis"') != "" || a.canPlayType('audio/mp4;codes="mp4a.40.5"') != "") {
				if (a.paused) {
					if (a.error) {
						f()
					} else {
						a.play()
					}
				} else {
					a.pause()
				}
			} else {
				alert("对不起，您的浏览器不支持HTML5音频播放，请升级您的浏览器。")
			}
		};
		b.removeAttribute("class")
	})()
}
var cornertool = true;

function cl() {
	var a = document.getElementById("catalog-col"),
		b = document.getElementById("catalog"),
		c = document.getElementById("cornertool"),
		d;
	if (a && !b) {
		if (c) {
			c = c.getElementsByTagName("ul")[0];
			d = document.createElement("li");
			d.setAttribute("id", "catalog");
			d.setAttribute("onclick", "Catalogswith()");
			d.appendChild(document.createElement("span"));
			c.appendChild(d)
		} else {
			cornertool = false;
			c = document.createElement("div");
			c.setAttribute("id", "cornertool");
			c.innerHTML = '<ul><li id="catalog" onclick="Catalogswith()"><span></span></li></ul>';
			document.body.appendChild(c)
		}
		document.getElementById("catalog").className = a.className
	}
	if (!a && b) {
		cornertool ? c.getElementsByTagName("ul")[0].removeChild(b) : document.body.removeChild(c)
	}
	if (a && b) {
		b.className = a.className
	}
}
cl();
if (typeof hljs !== 'undefined') {
	hljs.initHighlightingOnLoad()
}
console.log("\n%c Initial By JIElive %c http://www.offodd.com ", "color:#fff;background:#000;padding:5px 0", "color:#fff;background:#666;padding:5px 0")
